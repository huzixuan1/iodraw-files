```mermaid
graph TD
    A[编译预处理] -->[|启用XR_ENABLE_VIO_SOLVER_MEMPOOL| B(内存池初始化)
    A -->|未启用| C(标准内存分配)
    
    subgraph 内存池初始化
    B --> D[程序启动]
    D --> E[调用initialize()]
    E --> F{已初始化?}
    F -->|否| G[调用createBlockSizes()]
    G --> H[生成block_sizes映射表]
    H --> I[创建MemPool实例]
    I --> J{成功?}
    J -->|是| K[记录日志]
    J -->|否| L[抛出异常]
    K --> M[内存池就绪]
    end

    subgraph 对象分配
    N[调用XR_MAKE_SHARED_VARIABLE] --> O[获取单例实例]
    O --> P{内存池就绪?}
    P -->|是| Q[分配指定大小内存]
    P -->|否| R[抛出异常]
    Q --> S{分配成功?}
    S -->|是| T[placement new构造对象]
    S -->|否| U[记录警告]
    T --> V[返回带删除器的shared_ptr]
    end

    subgraph 对象释放
    W[shared_ptr引用归零] --> X[调用自定义删除器]
    X --> Y[显式调用析构函数]
    Y --> Z[内存归还内存池]
    end

    C --> AA[调用std::make_shared]
    AA --> AB[标准堆分配]
    
    style A fill:#f9f,stroke:#333
    style M fill:#cfc,stroke:#0f0
    style V fill:#ccf,stroke:#00f
    style Z fill:#fcc,stroke:#f00

```